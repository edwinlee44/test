 select 
COL_AGREE.M_NAME as COLLATERAL_AGREEMENT,
COL_AGREE.M_MXAGREEMEN as CONTEXT,
COL_AGREE.M_MXAGREEME2 as COLLAT_TYPE,
COL_AGREE.M_MXAGREEME0 as CURRENCY,
COL_AGREE.M_MXOURENTIT as LEGAL_ENTITY,
COL_AGREE.M_MXCTPENTIT as COUNTERPART,
COL_AGREE.M_MXPRODUCTS as PRODUCT_COVERED,
COL_AGREE.M_MXINITIALM as IA_OFFSET,
COL_AGREE.M_MXOURINITI as OUR_IA,
COL_AGREE.M_MXCTPINITI as CTP_IA,
COL_AGREE.M_MXOURTHRES as OUR_THRESHOLD,
COL_AGREE.M_MXCTPTHRES as CTP_THRESHOLD,
COL_AGREE.M_MXOURMINTR as OUR_MTA_IA_DELIV,
COL_AGREE.M_MXCTPMINTR as CTP_MTA_IA_DELIV,
COL_AGREE.M_MXOURMINT2 as OUR_MTA_VM_RET,
COL_AGREE.M_MXCTPMINT2 as CTP_MTA_VM_RET,
COL_AGREE.M_MXOURMINT1 as OUR_MTA_VM_DELIV,
COL_AGREE.M_MXCTPMINT1 as CTP_MTA_VM_DELIV, 
COL_AGREE.M_MXOURMINT0 as OUR_MTA_IA_RET,
COL_AGREE.M_MXCTPMINT0 as CTP_MTA_IA_RET,
COL_AGREE.M_MXMARGINR3 as ROUNDING_UNIT_VM,
COL_AGREE.M_MXMARGINR1 as ROUNDING_RULE_VM_RET,
COL_AGREE.M_MXMARGINR0 as ROUNDING_RULE_VM_DELIV,
COL_AGREE.M_MXROUNDIN0 as ROUNDING_OVERRIDE,
COL_AGREE.M_MXMARGINR4 as ROUNDING_UNIT_IA,
COL_AGREE.M_MXMARGINR2 as ROUNDING_RULE_IA_RET, 
COL_AGREE.M_MXMARGINR0 as ROUNDING_RULE_IA_DELIV, 
COL_AGREE.M_MXROUNDING as ROUNDING_OVERRIDE_IA,
COL_AGREE.M_IAMANAGEME as IA_MANAGEMENT,
case COL_AGREE.M_DELIVERYRE 
	when 'N' then 'No'
	else 'Yes' end as DELIV_RET_SPLIT,
case COL_AGREE.M_EXPECTEDCA 
	when 'N' then 'No'
	else 'Yes' end as MARGIN_CALL_EXPECT_MC,
case COL_ASSET.M_RE_HYPO
	when 0 then 'No'
	else 'Yes' end as RE_HYPOTHEC_ALLOW,
'empty' as CASH_ELIG_TMPL,
'empty' as SEC_ELIG_TMPL,
COL_ASSET.M_VAL_SCHE as VALUATION_SCHEDULE,
case COL_ASSET.M_TRANS_INC 
	when 0 then 'No'
	else 'Yes' end as IN_TRANSIT_INCL,
COL_ASSET.M_MDS as MDS,
'empty'  as MANAG_RULE_TMPL,
case COL_ASSET.M_SUBS_RGT 
	when 0 then 'No'
	else 'Yes' end as SUBSTI_ALLOW,
case COL_ASSET.M_LEGL_OWN 
when 0 then 'Pledge'
	else 'Title Transfer' end as LEGAL_OWNERSHIP,
case COL_ASSET.M_MARG_SPGH 
when 0 then 'No'
else 'Yes' end as MARG_SPHERE_CONNEC,
-- the nest fields are added to the sql datamart extractions query but are not output in the datamart views
COL_AGREE.M_MXAGREEME1 as AGREEMENT_SYMMETRY,
COL_AGREE.M_MXCTPCENTR as CTP_COVER_BRANCH,
COL_AGREE.M_MXOURCENTR as OUR_COVER_BRANCH,
case COL_ASSET.M_QUOT_MOD
	when 0 then 'Bid'
	else 'Mid' end as QUOTATION_MODE,
COL_ASSET.M_DEF_ALLOC as DEFAULT_ALLOC,
COL_ASSET.M_CSH_DEL as CASH_SETTL_DELAY,
'empty'  as M_COL_BOOK
from COL_AGREEMENT_FB_REP COL_AGREE 
left outer join COL_ASSET_COL_FB_REP COL_ASSET on (COL_AGREE.M_REF_DATA=COL_ASSET.M_REF_DATA and COL_AGREE.M_NAME=COL_ASSET.M_LABEL) 

where
COL_AGREE.M_REF_DATA=@MxDataSetKey:N