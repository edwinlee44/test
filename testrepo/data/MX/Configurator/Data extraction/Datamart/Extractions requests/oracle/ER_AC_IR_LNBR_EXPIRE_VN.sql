SELECT TO_CHAR(PL.M_CRT_BND12,'YYYYMMDD') AS DATA_DT,
PL.M_TP_ENTITY AS ENTITY,
CASE TRIM(PL.M_TP_ENTITY) WHEN 'VIETNAM963' THEN '963' WHEN 'VIETNAM960' THEN '960' WHEN 'VIETNAM962' THEN '962' ELSE TRIM(PL.M_TP_ENTITY) END  AS BU,
PL.M_TRN_GRP AS PROD,
PL.M_TP_TYPO AS TYPO,
PL.M_NB AS TRN_NB,
PL.M_TP_CNTRP AS CNTRP_CODE,
NVL(TRN.M_PAYREC,DECODE(FNC_AC_IR_TRN_PR_FLAG(PL.M_NB,PL.M_TP_PFOLIO,PL.M_REF_DATA,PL.M_CRT_BND12),  'P', 'LEND',  'R', 'BORROW',  NULL)) AS M_PAYREC1,
PL.M_TP_NOMCUR AS NOMINAL_CCY,
FNC_AC_ROUND(PL.M_TP_NOMCUR,PL.M_TP_NOMINAL) AS NOMINAL_AMT,
PL.M_TP_DTETRN AS TRADE_DATE,
PL.M_TP_DTEFST AS TRN_START_DATE,
PL.M_TP_DTEEXP AS TRN_MATURITY_DATE,
PL.M_TP_DTEEXP - M_TP_DTEFST AS TENOR,
PL.M_TP_PRICE AS INTEREST_RATE,
PL.M_TP_RTMCNV0 AS RATE_CONVENSION,
FNC_AC_ROUND(PL.M_TP_NOMCUR,ABS(PL.M_PLIRDACS12)) AS INTEREST,
FNC_AC_ROUND(PL.M_TP_NOMCUR,(ABS(PL.M_PLIRDACS12) + PL.M_TP_NOMINAL)) AS TOTAL_AMOUNT
FROM MXDM_IRD_PL_REP PL
LEFT JOIN V_EOD_DATE DT ON 1 = 1
LEFT JOIN RP_TRN_IRD_REP TRN 
          ON TRN.M_NB = PL.M_NB 
         AND TRN.M_TP_PFOLIO = PL.M_TP_PFOLIO 
         AND TRN.M_REF_DATA = PL.M_REF_DATA 
         AND TRN.M_CRT_BND12 = PL.M_CRT_BND12
WHERE PL.M_TP_TYPO = 'MM'
AND PL.M_TP_STATUS2 <> 'DEAD'
AND (PL.M_TP_DTEFST = DT.RPT_DT_ND OR  PL.M_TP_DTEEXP = DT.RPT_DT_ND)
AND PL.M_TP_ENTITY @I_ENTITY:C
AND PL.M_CRT_BND12 @I_DT:D